<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chucky's Playground — House Party Tickets</title>
  <meta name="description" content="Chucky's Playground — buy tickets for house parties. Mpesa Buy Goods ready (frontend sim). Admin editable."/>
  <style>
    /* ---- Visual theme based on your original design, fixed for mobile visibility ---- */
    :root{
      --primary:#ff2e63; --secondary:#f8b500; --accent:#2ec4b6;
      --dark:#1a1a2e; --panel: rgba(20,20,40,0.85); --light:#f8f9fa;
      --muted: rgba(248,249,250,0.8);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: "Segoe UI", Roboto, system-ui, -apple-system, Arial;
      background: linear-gradient(135deg,#0f0c29,#302b63,#24243e);
      color:var(--light); -webkit-font-smoothing:antialiased;
      display:flex; flex-direction:column; min-height:100vh;
    }

    /* Header / nav */
    header{
      position:sticky; top:0; z-index:60;
      background: rgba(10,10,20,0.9); backdrop-filter: blur(8px);
      border-bottom: 2px solid rgba(255,46,99,0.06);
    }
    .nav{max-width:1200px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .logo{display:flex;gap:12px;align-items:center}
    .logo .icon{width:48px;height:48px;border-radius:12px;background:linear-gradient(90deg,var(--primary),var(--secondary));display:flex;align-items:center;justify-content:center;font-weight:900;color:#111}
    .logo h1{font-size:1.05rem;margin:0;color:var(--primary);line-height:1}
    .logo .sub{font-size:0.82rem;color:var(--muted);margin-top:4px}

    nav {display:flex;gap:18px;align-items:center}
    nav a{color:var(--light);text-decoration:none;font-weight:700}
    nav a.active{color:var(--primary)}

    /* main layout */
    main{max-width:1200px;margin:18px auto;padding:18px;width:100%;flex:1}
    .card{background:var(--panel);border-radius:var(--radius);padding:18px;box-shadow:0 8px 30px rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.03)}
    .hero{display:grid;gap:18px;align-items:center;padding:26px;border-radius:14px;overflow:hidden;
      background:
        radial-gradient(circle at 10% 20%, rgba(255,46,99,0.06), transparent 15%),
        radial-gradient(circle at 90% 80%, rgba(248,181,0,0.03), transparent 15%);
    }

    /* hero layout: mobile-first ensures content visible */
    .hero-inner{display:flex;flex-direction:column;gap:12px;align-items:flex-start}
    .hero-left{flex:1}
    .hero h2{font-size:1.8rem;margin:6px 0;color:var(--light);line-height:1.05}
    .hero p{color:var(--muted);margin:0 0 6px}
    .cta-row{display:flex;gap:10px;flex-wrap:wrap}

    .btn{display:inline-block;padding:10px 16px;border-radius:999px;font-weight:800;text-decoration:none;cursor:pointer;letter-spacing:0.4px}
    .btn-primary{background:linear-gradient(90deg,var(--primary),var(--secondary));color:#111}
    .btn-outline{color:var(--primary);background:transparent;border:2px solid rgba(255,46,99,0.14);}

    /* event card */
    .event-grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:14px}
    .event-image{height:260px;background-size:cover;background-position:center;border-radius:12px;overflow:hidden}
    .event-info{padding:12px 6px}
    .muted{color:var(--muted)}
    .price-badge{display:inline-block;padding:8px 12px;background:linear-gradient(90deg,var(--primary),var(--secondary));color:#111;border-radius:999px;font-weight:900}

    /* sections */
    .section{margin-top:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}

    /* forms */
    label{display:block;font-weight:700;margin-bottom:6px;color:var(--muted)}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--light);outline:none}
    .row{display:flex;gap:12px}
    .row>.col{flex:1}

    footer{padding:18px 20px;text-align:center;color:var(--muted);font-size:0.95rem;background:linear-gradient(180deg,rgba(0,0,0,0.25),transparent)}
    .badge{display:inline-block;padding:6px 10px;background:rgba(255,46,99,0.08);color:var(--primary);border-radius:999px;font-weight:700}

    /* small screens and wide */
    @media(min-width:900px){
      .hero{grid-template-columns:1fr 420px}
      .hero h2{font-size:2.6rem}
      .event-grid{grid-template-columns:1fr 360px}
    }

    /* toast */
    .toast{position:fixed;right:18px;bottom:18px;background:#0f0f12;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);z-index:140}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="logo">
        <div class="icon">CP</div>
        <div>
          <h1>Chucky's Playground</h1>
          <div class="sub">House party events • Tickets • Mpesa Buy Goods</div>
        </div>
      </div>
      <nav id="mainNav">
        <a href="#home" data-link>Home</a>
        <a href="#event" data-link>Event</a>
        <a href="#checkout" data-link>Checkout</a>
        <a href="#dashboard" data-link>Dashboard</a>
        <a href="#admin" data-link>Admin</a>
        <a href="#about" data-link>About</a>
      </nav>
    </div>
  </header>

  <main id="app" role="main">
    <!-- Content injected by script -->
  </main>

  <footer>
    © <span id="year"></span> Chucky's Playground • Built with ❤️ • <a id="repoLink" href="#" target="_blank" style="color:var(--primary);text-decoration:underline">GitHub Repo</a>
  </footer>

  <div id="toast" class="toast" style="display:none"></div>

<script>
/* ========= CONFIG - change these before publishing ========= */
const ADMIN_PASSWORD = "changeme"; // <-- change to a strong password
const MPESA_API_URL = "https://YOUR_BACKEND.example.com/mpesa/buygoods"; // <-- optional server endpoint
const GITHUB_REPO_URL = "https://github.com/danielskumbo-sys/chuckysplayground.github.io";
/* ========================================================= */

function el(tag, props={}, ...children){
  const e = document.createElement(tag);
  for(const k in props){
    if(k==='class') e.className = props[k];
    else if(k==='html') e.innerHTML = props[k];
    else if(k==='onclick') e.addEventListener('click', props[k]);
    else e.setAttribute(k, props[k]);
  }
  children.flat().forEach(c => {
    if(c == null) return;
    e.append(typeof c === 'string' ? document.createTextNode(c) : c);
  });
  return e;
}
const q = s => document.querySelector(s);
const showToast = (t, ms=3000) => {
  const box = q('#toast'); box.innerText = t; box.style.display='block';
  clearTimeout(box._t); box._t = setTimeout(()=>box.style.display='none', ms);
};

/* ======== data: default + persistence ======== */
const defaultData = {
  siteTitle: "Chucky's Playground",
  heroTitle: "Welcome to the Ultimate House Party",
  heroSubtitle: "Buy tickets, join the dance floor — Mpesa Buy Goods ready.",
  event:{
    id: "evt1",
    title: "Chucky's Epic House Party",
    date: "2025-12-20 22:00",
    location: "Daniel's Villa • Nairobi",
    price: 1200,
    currency: "KES",
    image: "https://via.placeholder.com/1200x800/1a1a2e/ff2e63?text=House+Party",
    description: "An unforgettable night with DJs, premium bar and a lively dance floor. Limited tickets available.",
    seats: 200
  },
  purchases: []
};

function loadData(){
  try{
    const raw = localStorage.getItem('cp_data');
    return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(defaultData));
  } catch(e){ return JSON.parse(JSON.stringify(defaultData)); }
}
function saveData(data){ localStorage.setItem('cp_data', JSON.stringify(data)); }

let DATA = loadData();
saveData(DATA);

/* ======== router & nav active ======== */
function currentRoute(){ return location.hash.replace('#','') || 'home' }
function navigate(h){ location.hash = h; }
window.addEventListener('hashchange', render);
document.addEventListener('click', e => {
  const a = e.target.closest('a[data-link]');
  if(a){ e.preventDefault(); const to = (a.getAttribute('href')||'#home').replace('#',''); navigate(to); }
});

function setActiveNav(){
  document.querySelectorAll('#mainNav a').forEach(a=>{
    a.classList.toggle('active', a.getAttribute('href') === '#' + currentRoute());
  });
}

/* ======== views ======== */
function viewHome(){
  const c = DATA;
  const left = el('div',{class:'hero-left'},
    el('h2',{}, c.heroTitle),
    el('p',{}, c.heroSubtitle),
    el('div',{class:'cta-row'},
      el('a',{class:'btn btn-primary', href:'#event', 'data-link':true}, 'View Event'),
      el('a',{class:'btn btn-outline', href:'#checkout', 'data-link':true}, 'Buy Ticket')
    )
  );

  const right = el('div', {class:'card', style:'padding:12px;max-width:420px;border-radius:12px;'},
    el('img',{src:c.event.image, alt:'event', style:'width:100%;height:200px;object-fit:cover;border-radius:10px'}),
    el('div',{class:'event-info'},
      el('h3',{}, c.event.title),
      el('div',{class:'muted'}, `${c.event.date} • ${c.event.location}`),
      el('div',{style:'margin-top:8px'}, el('span',{class:'price-badge'}, `${c.event.currency} ${c.event.price}`)),
      el('div',{style:'margin-top:12px;display:flex;gap:8px'},
         el('a',{class:'btn btn-primary', href:'#checkout', 'data-link':true}, 'Checkout'),
         el('a',{class:'btn btn-outline', href:'#event', 'data-link':true}, 'Details')
      )
    )
  );

  const hero = el('section',{class:'card hero'},
     el('div',{class:'hero-inner'}, left),
     right
  );

  const about = el('div',{class:'section card'},
    el('h3',{}, 'About the Party'),
    el('p',{class:'muted'}, DATA.event.description)
  );

  return el('div',{}, hero, about);
}

function viewEvent(){
  const e = DATA.event;
  return el('div',{},
    el('div',{class:'card'},
      el('img',{src:e.image, style:'width:100%;height:420px;object-fit:cover;border-radius:10px'}),
      el('div',{style:'margin-top:12px'},
         el('h2',{}, e.title),
         el('div',{class:'muted'}, `${e.date} • ${e.location}`),
         el('p',{class:'muted', style:'margin-top:8px'}, e.description),
         el('div',{style:'margin-top:12px;display:flex;gap:12px;align-items:center'},
           el('div',{class:'price-badge'}, `${e.currency} ${e.price}`),
           el('a',{class:'btn btn-primary', href:'#checkout', 'data-link':true}, 'Buy Ticket')
         )
      )
    )
  );
}

function viewCheckout(){
  const e = DATA.event;
  return el('div',{},
    el('div',{class:'card'},
      el('h2',{}, 'Checkout'),
      el('p',{class:'muted'}, `Event: ${e.title}`),
      el('form',{id:'checkoutForm', onsubmit:(ev)=>{ev.preventDefault(); handleCheckout();}},
        el('label',{}, 'Full name'),
        el('input',{id:'buyerName', placeholder:'Your full name', required:true}),
        el('label',{}, 'Phone (M-PESA number, e.g. 2547XXXXXXXX)'),
        el('input',{id:'buyerPhone', placeholder:'2547XXXXXXXX', required:true}),
        el('label',{}, 'Quantity'),
        el('input',{id:'qty', type:'number', min:1, value:1, required:true}),
        el('label',{}, 'Payment method'),
        el('select',{id:'payMethod'},
           el('option',{value:'mpesa'}, 'M-PESA (Buy Goods)'),
           el('option',{value:'manual'}, 'Manual / Other')
        ),
        el('div',{style:'margin-top:12px;display:flex;gap:10px'},
            el('button',{class:'btn btn-primary', type:'submit'}, 'Pay / Request M-PESA'),
            el('button',{type:'button', class:'btn btn-outline', onclick:()=>navigate('event')}, 'Back')
        ),
        el('p',{class:'muted', style:'margin-top:10px'}, 'Note: M-PESA Buy Goods requires a backend to call Safaricom. The site will POST to your backend endpoint if configured; otherwise the payment is simulated.')
      )
    )
  );
}

function viewDashboard(){
  const rows = (DATA.purchases || []).slice().reverse();
  const body = el('div',{},
    el('div',{class:'card'},
      el('h2',{}, 'Dashboard'),
      rows.length === 0 ? el('p',{class:'muted'}, 'You have no purchases yet.') :
      el('div',{style:'display:flex;flex-direction:column;gap:8px'},
        ...rows.map(p => el('div',{style:'padding:10px;border-radius:8px;background:rgba(255,255,255,0.02)'},
           el('div',{}, el('strong',{}, p.name + ' '), el('span',{class:'muted'}, `(${p.phone})`)),
           el('div',{class:'muted'}, `Qty: ${p.qty} • Total: ${p.currency} ${p.total}`),
           el('div',{class:'muted'}, `Status: ${p.status}`)
        ))
      )
    )
  );
  return body;
}

function viewAdmin(){
  const logged = sessionStorage.getItem('cp_admin') === '1';
  if(!logged){
    return el('div',{},
      el('div',{class:'card'},
        el('h2',{}, 'Admin Login'),
        el('p',{class:'muted'}, 'Enter admin password to edit site content (client-side).'),
        el('form',{onsubmit:(ev)=>{ev.preventDefault(); adminLogin();}},
           el('label',{}, 'Password'),
           el('input',{id:'adminPass', type:'password', placeholder:'Admin password', required:true}),
           el('div',{style:'margin-top:12px;display:flex;gap:10px'},
             el('button',{class:'btn btn-primary', type:'submit'}, 'Login'),
             el('button',{type:'button', class:'btn btn-outline', onclick:()=>{downloadData()}}, 'Export Data')
           )
        )
      )
    );
  } else {
    return el('div',{},
      el('div',{class:'card'},
        el('div',{style:'display:flex;align-items:center;justify-content:space-between;gap:12px'},
           el('h2',{}, 'Admin Panel'),
           el('div',{},
             el('button',{class:'btn btn-outline', onclick:()=>{sessionStorage.removeItem('cp_admin'); navigate('home'); render();}}, 'Logout')
           )
        ),
        el('form',{id:'adminForm', onsubmit:(ev)=>{ev.preventDefault(); saveAdmin();}},
          el('label',{}, 'Site title'),
          el('input',{id:'admin_siteTitle', value:DATA.siteTitle}),
          el('label',{}, 'Hero title'),
          el('input',{id:'admin_heroTitle', value:DATA.heroTitle}),
          el('label',{}, 'Hero subtitle'),
          el('input',{id:'admin_heroSubtitle', value:DATA.heroSubtitle}),
          el('hr',{}),
          el('label',{}, 'Event title'),
          el('input',{id:'admin_evt_title', value:DATA.event.title}),
          el('label',{}, 'Date & time'),
          el('input',{id:'admin_evt_date', value:DATA.event.date}),
          el('label',{}, 'Location'),
          el('input',{id:'admin_evt_location', value:DATA.event.location}),
          el('label',{}, 'Image URL'),
          el('input',{id:'admin_evt_image', value:DATA.event.image}),
          el('label',{}, 'Price'),
          el('input',{id:'admin_evt_price', value:DATA.event.price}),
          el('label',{}, 'Currency'),
          el('input',{id:'admin_evt_currency', value:DATA.event.currency}),
          el('label',{}, 'Description'),
          el('textarea',{id:'admin_evt_desc', rows:6}, DATA.event.description),
          el('div',{style:'margin-top:12px;display:flex;gap:10px'},
            el('button',{class:'btn btn-primary', type:'submit'}, 'Save changes'),
            el('button',{type:'button', class:'btn btn-outline', onclick:()=>{downloadData()}}, 'Export data'),
            el('button',{type:'button', class:'btn btn-outline', onclick:()=>{resetData()}}, 'Reset defaults')
          ),
          el('p',{class:'muted', style:'margin-top:10px'}, 'Edits are saved to your browser localStorage. For real secure admin you need a backend auth system.')
        )
      )
    );
  }
}

function viewAbout(){
  return el('div',{},
    el('div',{class:'card'},
      el('h2',{}, 'About'),
      el('p',{class:'muted'}, "Chucky's Playground is a house party events site. Buy tickets quickly via M-PESA Buy Goods (requires a backend). Admin edits are client-side for now.")
    )
  );
}

/* ======== actions ======== */
async function handleCheckout(){
  const name = q('#buyerName').value.trim();
  const phone = q('#buyerPhone').value.trim();
  const qty = parseInt(q('#qty').value,10) || 1;
  const method = q('#payMethod').value;
  if(!name || !phone){ showToast('Please enter name & phone'); return; }

  const evt = DATA.event;
  const total = (evt.price * qty);

  const purchase = { id:'p_'+Date.now(), name, phone, qty, total, currency:evt.currency, eventId:evt.id, created:new Date().toISOString(), status:'pending' };

  if(method === 'mpesa'){
    showToast('Initiating M-PESA buy goods...');
    // if MPESA_API_URL is not configured, simulate success
    if(!MPESA_API_URL || MPESA_API_URL.includes('YOUR_BACKEND')){
      await new Promise(r => setTimeout(r,1000));
      purchase.status = 'paid (simulated)';
      DATA.purchases = DATA.purchases || []; DATA.purchases.push(purchase); saveData(DATA);
      showToast('Payment simulated OK — check Dashboard.');
      navigate('dashboard'); render();
      return;
    }

    // call backend endpoint
    try{
      const resp = await fetch(MPESA_API_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ name, phone, qty, total, eventId: evt.id, description: evt.title })
      });
      const json = await resp.json();
      if(json && json.success){
        purchase.status = 'paid';
        purchase.receipt = json.receipt || null;
        DATA.purchases = DATA.purchases || []; DATA.purchases.push(purchase); saveData(DATA);
        showToast('Payment successful. Check Dashboard.');
        navigate('dashboard'); render();
      } else {
        purchase.status = 'failed';
        DATA.purchases = DATA.purchases || []; DATA.purchases.push(purchase); saveData(DATA);
        showToast('Payment failed: '+(json && json.message ? json.message : 'unknown'));
      }
    } catch(err){
      console.error(err); purchase.status='failed';
      DATA.purchases = DATA.purchases || []; DATA.purchases.push(purchase); saveData(DATA);
      showToast('Network error contacting MPESA endpoint.');
    }
  } else {
    // manual
    purchase.status = 'manual - pending';
    DATA.purchases = DATA.purchases || []; DATA.purchases.push(purchase); saveData(DATA);
    showToast('Order saved — manual payment selected.');
    navigate('dashboard'); render();
  }
}

/* admin */
function adminLogin(){
  const val = q('#adminPass').value || '';
  if(val === ADMIN_PASSWORD){
    sessionStorage.setItem('cp_admin','1');
    showToast('Admin logged in');
    navigate('admin'); render();
  } else {
    showToast('Wrong password');
  }
}
function saveAdmin(){
  DATA.siteTitle = q('#admin_siteTitle').value;
  DATA.heroTitle = q('#admin_heroTitle').value;
  DATA.heroSubtitle = q('#admin_heroSubtitle').value;
  DATA.event.title = q('#admin_evt_title').value;
  DATA.event.date = q('#admin_evt_date').value;
  DATA.event.location = q('#admin_evt_location').value;
  DATA.event.image = q('#admin_evt_image').value;
  DATA.event.price = parseFloat(q('#admin_evt_price').value) || DATA.event.price;
  DATA.event.currency = q('#admin_evt_currency').value || DATA.event.currency;
  DATA.event.description = q('#admin_evt_desc').value;
  saveData(DATA);
  showToast('Changes saved');
  render();
}
function resetData(){
  if(confirm('Reset site data to defaults? This will overwrite local edits.')){
    localStorage.removeItem('cp_data');
    DATA = JSON.parse(JSON.stringify(defaultData));
    saveData(DATA); showToast('Reset done'); render();
  }
}
function downloadData(){
  const blob = new Blob([JSON.stringify(DATA, null, 2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'chuckysplayground-data.json';
  document.body.appendChild(a); a.click(); a.remove();
}

/* ======== render ======== */
function render(){
  setActiveNav();
  const out = q('#app'); out.innerHTML = '';
  const r = currentRoute();
  q('#year').innerText = new Date().getFullYear();
  q('#repoLink').href = GITHUB_REPO_URL;

  let node;
  switch(r){
    case 'hom